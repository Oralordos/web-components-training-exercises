<template id="template">
    <div id="showing">
        <content></content>
    </div>
</template>
<script src="../createElement.js"></script>
<script>
    function toggleStyle() {
        var interval = parseInt(this.getAttribute('interval')) || 1000;
        this.timeoutId = setTimeout(toggleStyle.bind(this), interval);
        var item = this.shadowRoot.querySelector('#showing');
        item.currentSetting = !item.currentSetting;
        var styleText = this.getAttribute('styles') || 'visibility: hidden';
        var styles = styleText.split(',');
        styles.forEach(function(style) {
            keyVal = style.split(':');
            item.style[keyVal[0].trim()] = item.currentSetting ? keyVal[1].trim() : '';
        });
    }

    function loader() {
        clearStyle.call(this);
        var interval = parseInt(this.getAttribute('interval')) || 1000;
        this.timeoutId = setTimeout(toggleStyle.bind(this), interval);
    }

    function cleanUp() {
        clearTimeout(this.timeoutId);
    }

    function clearStyle() {
        var item = this.shadowRoot.querySelector('#showing');
        for (var key in item.style) {
            if (item.style.hasOwnProperty(key)) {
                item.style[key] = '';
            }
        }
        item.currentSetting = 0;
    }

    var proto = Object.create(HTMLElement.prototype);
    proto.createdCallback = loader;
    proto.detachedCallback = cleanUp;
    proto.attributeChangedCallback = clearStyle;
    proto.stop = cleanUp;
    proto.start = loader;
    window.MyBlink = createElement('my-blink', '#template', proto);
</script>